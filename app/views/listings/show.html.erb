<div>
  <div>
    <h1>
     <%= @the_listing.title %> details
    </h1>

    <div>
      <div>
        <a href="/listings">
          Go back
        </a>
      </div>
    </div>

    <dl>
      <dt>
        Title
      </dt>
      <dd>
        <%= @the_listing.title %>
      </dd>

      <dt>
        Description
      </dt>
      <dd>
        <%= @the_listing.description %>
      </dd>

      <dt>
        Price
      </dt>
      <dd>
        <%= number_to_currency(@the_listing.price, unit: "$") %>
      </dd>

      <dt>
        Image
      </dt>
      <dd>
        <%= @the_listing.image %>
      </dd>

      <dt>
        Status
      </dt>
      <dd>
        <%= @the_listing.status %>
      </dd>

      <dt>
        Category
      </dt>
      <dd>
         <% category = Category.find(@the_listing.category_id) %>
         <%= category.name %>
      </dd>

      <dt>
        Seller
      </dt>
      <dd>
        <%= @the_listing.seller.name %>
      </dd>

      <dt>
        Location
      </dt>
      <dd>
       <iframe>
       <%= src="https://www.google.com/maps/@41.8684311,-87.662324,13.36z" %>
       </iframe>
      </dd>

      <dt>
        Buyer
      </dt>
      <dd>
        <%= @the_listing.buyer_id %>
      </dd>

      <dt>
        Created at
      </dt>
      <dd>
        <%= time_ago_in_words(@the_listing.created_at) %> ago
      </dd>

      <dt>
        Updated at
      </dt>
      <dd>
        <%= time_ago_in_words(@the_listing.updated_at) %> ago
      </dd>
    </dl>
  </div>
</div>

<%# TODO: list all the messages for this listing %>
<div class="conversation">
  <h3>Conversation</h3>
  <% @the_listing.messages.each do |message| %>
    <div class="message <%= message.sender == @current_user ? "sent" : "received" %>">
      <div class="content">
        <div class="meta">
          <span class="author"><%= message.sender.name %></span>
          <span class="time"><%= message.created_at.strftime("%b %d, %Y %I:%M %p") %></span>
        </div>
        <div class="text"><%= message.body %></div>
      </div>
    </div>
  <% end %>
</div>


<div>
  Contact <%= @the_listing.seller.name %> in order to purchase <%= @the_listing.title %>
</div>

<div>
  <%= form_with(model: @message, url: messages_path) do |form| %>
    <%= form.hidden_field :sender_id, value: @current_user.id %>
    <%= form.hidden_field :item_id, value: @the_listing.id %>
    <%= form.hidden_field :recipient_id, value: @the_listing.seller.id %>

    <div>
      <%= form.label " #{@the_listing.seller.id}" %>
      <%= form.text_area :body, class: "form-control", placeholder: "Message #{@the_listing.seller.id}" %>
    </div>

    <%= form.submit "Send" %>
  <% end %>
</div>

<hr>


<div>
  <div>
  <% if session.fetch(:user_id) == @the_listing.seller_id %>
    <h2>
      Edit listing
    </h2>

    <form action="/modify_listing/<%= @the_listing.id %>"  method="post" >
      <div>
        <label for="title_box">
          Title
        </label>

        <input type="text" id="title_box" name="query_title" value="<%= @the_listing.title %>">
      </div>

      <div>
        <label for="description_box">
          Description
        </label>

        <input type="text" id="description_box" name="query_description" value="<%= @the_listing.description %>">
      </div>

      <div>
        <label for="price_box">
          Price
        </label>

        <input type="text" id="price_box" name="query_price" value="<%= @the_listing.price %>">
      </div>

      <div>
        <label for="image_box">
          Image
        </label>

        <input type="text" id="image_box" name="query_image" value="<%= @the_listing.image %>">
      </div>

      <div>
        <label for="status_box">
          Status
        </label>

        <input type="text" id="status_box" name="query_status" value="<%= @the_listing.status %>">
      </div>

<div>
  <label for="category_id_box">
    Category
  </label>
  <select id="category_id_box" name="query_category_id">
     <% @categories.each do |category| %>
     <option value="<%= category.id %>"><%= category.name %>
     </option>
      <% end %>
  </select>
</div>

      <div>
        <label for="seller_id_box">

        </label>

        <input type="hidden" id="seller_id_box" name="query_seller_id" value="<%= @the_listing.seller_id %>">
      </div>

      <div>
        <label for="buyer_id_box">
          
        </label>

        <input type="hidden" id="buyer_id_box" name="query_buyer_id" value="<%= @the_listing.buyer_id %>">
      </div>

       <div>
        <a href="/delete_listing/<%= @the_listing.id %>">
          Delete listing
        </a>
      </div>

      <button>
        Update listing
      </button>
      <% end %>
    </form>
  </div>
</div>

<hr>
